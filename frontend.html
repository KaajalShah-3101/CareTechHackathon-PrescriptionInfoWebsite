<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MedCheck — Dosage Verification</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg:        #f7f6f2;
    --surface:   #ffffff;
    --border:    #e2dfd8;
    --text:      #18181b;
    --muted:     #71717a;
    --accent:    #1d4ed8;
    --accent-lt: #eff6ff;
    --mono:      'DM Mono', monospace;
    --sans:      'DM Sans', sans-serif;
    --radius:    8px;
    --shadow:    0 1px 4px rgba(0,0,0,0.07), 0 4px 16px rgba(0,0,0,0.04);
    --transition: 0.45s cubic-bezier(.4,0,.2,1);
  }

  body {
    font-family: var(--sans);
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding: 48px 20px 64px;
    transition: background var(--transition);
  }

  body.state-safe  { background: #ecfdf5; }
  body.state-low   { background: #fffbeb; }
  body.state-high  { background: #fff1f2; }

  .wrap {
    max-width: 580px;
    margin: 0 auto;
  }

  /* Brand */
  .brand {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 36px;
  }
  .brand-icon {
    width: 36px; height: 36px;
    background: var(--accent);
    border-radius: 8px;
    display: grid; place-items: center;
    color: white; font-size: 1.2rem;
  }
  .brand-name {
    font-family: var(--mono);
    font-size: 1.05rem;
    font-weight: 500;
  }
  .brand-sub {
    font-size: 0.75rem;
    color: var(--muted);
  }

  /* Card */
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 28px;
    margin-bottom: 16px;
    box-shadow: var(--shadow);
  }

  .card.locked {
    opacity: 0.45;
    pointer-events: none;
  }

  .section-label {
    font-family: var(--mono);
    font-size: 0.68rem;
    font-weight: 500;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    border-bottom: 1px solid var(--border);
    padding-bottom: 10px;
    margin-bottom: 22px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .step-dot {
    width: 20px; height: 20px;
    border-radius: 50%;
    background: var(--accent);
    color: white;
    font-size: 0.65rem;
    display: grid; place-items: center;
    flex-shrink: 0;
  }

  /* Form */
  .field-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    margin-bottom: 14px;
  }

  .field {
    display: flex;
    flex-direction: column;
    gap: 5px;
  }

  .field-full { margin-bottom: 14px; }

  label {
    font-size: 0.78rem;
    font-weight: 500;
    color: var(--muted);
  }

  input, select {
    font-family: var(--sans);
    font-size: 0.9rem;
    color: var(--text);
    background: #fafaf9;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 9px 12px;
    outline: none;
    width: 100%;
    transition: border-color 0.2s, background 0.2s;
    -webkit-appearance: none;
  }

  input:focus, select:focus {
    border-color: var(--accent);
    background: #fff;
  }

  /* Button */
  .btn {
    width: 100%;
    background: var(--accent);
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 11px 16px;
    font-family: var(--mono);
    font-size: 0.82rem;
    font-weight: 500;
    letter-spacing: 0.04em;
    cursor: pointer;
    margin-top: 6px;
    transition: opacity 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .btn:hover    { opacity: 0.88; }
  .btn:disabled { opacity: 0.45; cursor: not-allowed; }

  .spinner {
    width: 14px; height: 14px;
    border: 2px solid rgba(255,255,255,0.35);
    border-top-color: #fff;
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
    display: none;
  }

  .btn.loading .spinner   { display: block; }
  .btn.loading .btn-text  { opacity: 0.7; }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* Range cells */
  .range-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 10px;
    margin-bottom: 18px;
  }

  .range-cell {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 12px 14px;
  }

  .range-cell-label {
    font-size: 0.68rem;
    color: var(--muted);
    font-family: var(--mono);
    text-transform: uppercase;
    letter-spacing: 0.07em;
    margin-bottom: 4px;
  }

  .range-cell-value {
    font-family: var(--mono);
    font-size: 1.05rem;
    font-weight: 500;
    color: var(--accent);
  }

  /* Med meta */
  .med-meta {
    background: var(--accent-lt);
    border: 1px solid #bfdbfe;
    border-radius: 6px;
    padding: 12px 14px;
    margin-bottom: 18px;
    font-size: 0.8rem;
    color: #1e40af;
    line-height: 1.55;
    display: none;
  }

  .med-meta strong {
    display: block;
    font-size: 0.95rem;
    margin-bottom: 2px;
  }

  /* Status banner */
  .status-banner {
    margin-top: 16px;
    border-radius: 6px;
    padding: 14px 16px;
    display: none;
    animation: slideIn 0.3s ease;
  }

  .status-banner.show { display: block; }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-6px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .status-banner.safe { background: #d1fae5; border: 1px solid #6ee7b7; color: #065f46; }
  .status-banner.low  { background: #fef3c7; border: 1px solid #fcd34d; color: #78350f; }
  .status-banner.high { background: #ffe4e6; border: 1px solid #fda4af; color: #9f1239; }

  .status-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 4px;
  }

  .status-icon  { font-size: 1.1rem; }
  .status-title { font-family: var(--mono); font-size: 0.82rem; font-weight: 500; letter-spacing: 0.04em; }
  .status-detail { font-size: 0.8rem; opacity: 0.9; line-height: 1.5; }

  /* Error */
  .error-msg {
    background: #fff1f2;
    border: 1px solid #fda4af;
    border-radius: 6px;
    padding: 10px 14px;
    font-size: 0.8rem;
    color: #9f1239;
    margin-top: 10px;
    display: none;
  }
  .error-msg.show { display: block; }

  /* Footer */
  .disclaimer {
    text-align: center;
    font-size: 0.71rem;
    color: var(--muted);
    line-height: 1.6;
    max-width: 480px;
    margin: 24px auto 0;
    padding-top: 20px;
    border-top: 1px solid var(--border);
  }

  @media (max-width: 460px) {
    .field-grid, .range-grid { grid-template-columns: 1fr; }
    body { padding: 28px 14px 48px; }
  }
</style>
</head>
<body>

<div class="wrap">

  <div class="brand">
    <div class="brand-icon">＋</div>
    <div>
      <div class="brand-name">MedCheck</div>
      <div class="brand-sub">Medication Dosage Verification</div>
    </div>
  </div>

  <!-- Step 1: Patient Info -->
  <div class="card" id="cardPatient">
    <div class="section-label">
      <span class="step-dot">1</span>
      Patient Information
    </div>

    <div class="field-grid">
      <div class="field">
        <label for="weight">Weight (kg)</label>
        <input type="number" id="weight" placeholder="e.g. 70" min="1" max="300" step="0.1">
      </div>
      <div class="field">
        <label for="age">Age (years)</label>
        <input type="number" id="age" placeholder="e.g. 35" min="0" max="120" step="1">
      </div>
    </div>

    <div class="field-grid">
      <div class="field">
        <label for="sex">Biological Sex</label>
        <select id="sex">
          <option value="">— Select —</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other / Prefer not to say</option>
        </select>
      </div>
      <div class="field">
        <label for="condition">Condition (optional)</label>
        <input type="text" id="condition" placeholder="e.g. hypertension">
      </div>
    </div>

    <div class="field-full field">
      <label for="medication">Medication Name</label>
      <input type="text" id="medication" placeholder="e.g. Ibuprofen" autocomplete="off">
    </div>

    <div class="error-msg" id="patientError"></div>

    <button class="btn" id="fetchBtn" onclick="fetchDosage()">
      <div class="spinner"></div>
      <span class="btn-text">Look Up Safe Dosage Range</span>
    </button>
  </div>

  <!-- Step 2: Range + Verification -->
  <div class="card locked" id="cardDosage">
    <div class="section-label">
      <span class="step-dot">2</span>
      Dosage Information
    </div>

    <div class="med-meta" id="medMeta">
      <strong id="metaMedName">—</strong>
      <span id="metaNotes"></span>
    </div>

    <div class="range-grid">
      <div class="range-cell">
        <div class="range-cell-label">Min Dose</div>
        <div class="range-cell-value" id="displayMin">—</div>
      </div>
      <div class="range-cell">
        <div class="range-cell-label">Max Dose</div>
        <div class="range-cell-value" id="displayMax">—</div>
      </div>
      <div class="range-cell">
        <div class="range-cell-label">Recommended</div>
        <div class="range-cell-value" id="displayRec">—</div>
      </div>
    </div>

    <div class="field">
      <label for="prescribed">Enter Prescribed Dose (mg)</label>
      <input type="number" id="prescribed" placeholder="Type the dose to verify…" min="0" step="0.1" oninput="checkDose()">
    </div>

    <div class="status-banner" id="statusBanner">
      <div class="status-header">
        <span class="status-icon" id="statusIcon"></span>
        <span class="status-title" id="statusTitle"></span>
      </div>
      <div class="status-detail" id="statusDetail"></div>
    </div>
  </div>

  <p class="disclaimer">
    ⚠ MedCheck queries a clinical medication dataset and is intended as a reference aid only.
    Always verify dosages against current prescribing guidelines and the patient's full medical history.
    This tool does not replace professional clinical judgment.
  </p>

</div>

<script>
  // ─────────────────────────────────────────────────────────────────
  //  API CONFIG — point this at your Flask server
  // ─────────────────────────────────────────────────────────────────
  const API_BASE = 'http://localhost:5000';

  /*
  ╔═══════════════════════════════════════════════════════════════════╗
  ║  FLASK ENDPOINT CONTRACT                                          ║
  ║                                                                   ║
  ║  POST /api/dosage                                                 ║
  ║                                                                   ║
  ║  Request JSON body:                                               ║
  ║  {                                                                ║
  ║    "medication": "ibuprofen",   // string, required               ║
  ║    "weight":     70,            // number (kg), required          ║
  ║    "age":        35,            // number (years), required       ║
  ║    "sex":        "male",        // "male"|"female"|"other"        ║
  ║    "condition":  "headache"     // string, optional               ║
  ║  }                                                                ║
  ║                                                                   ║
  ║  Expected success response (HTTP 200):                            ║
  ║  {                                                                ║
  ║    "medication":        "Ibuprofen",   // display name            ║
  ║    "min_dose":          200,           // number, mg              ║
  ║    "max_dose":          800,           // number, mg              ║
  ║    "recommended_dose":  400,           // number, mg              ║
  ║    "unit":              "mg",          // string                  ║
  ║    "condition":         "Pain Relief", // string, optional        ║
  ║    "notes":             "Take with food." // string, optional     ║
  ║  }                                                                ║
  ║                                                                   ║
  ║  Error response (HTTP 400 / 404):                                 ║
  ║  { "error": "Medication not found in dataset" }                   ║
  ╚═══════════════════════════════════════════════════════════════════╝
  */

  let doseData = null;

  async function fetchDosage() {
    const weight     = parseFloat(document.getElementById('weight').value);
    const age        = parseFloat(document.getElementById('age').value);
    const sex        = document.getElementById('sex').value;
    const condition  = document.getElementById('condition').value.trim();
    const medication = document.getElementById('medication').value.trim();
    const errEl      = document.getElementById('patientError');

    errEl.classList.remove('show');

    if (!weight || !age || !medication) {
      showError(errEl, 'Please enter weight, age, and a medication name.');
      return;
    }

    const btn = document.getElementById('fetchBtn');
    btn.classList.add('loading');
    btn.disabled = true;

    try {
      const res = await fetch(`${API_BASE}/api/dosage`, {
        method:  'POST',
        headers: { 'Content-Type': 'application/json' },
        body:    JSON.stringify({ medication, weight, age, sex, condition })
      });

      const data = await res.json();

      if (!res.ok) throw new Error(data.error || `Server error (${res.status})`);

      doseData = data;
      populateDosageCard(data);

    } catch (err) {
      showError(errEl, `Could not retrieve dosage data: ${err.message}`);
    } finally {
      btn.classList.remove('loading');
      btn.disabled = false;
    }
  }

  function populateDosageCard(data) {
    const unit = data.unit || 'mg';

    document.getElementById('displayMin').textContent = `${data.min_dose} ${unit}`;
    document.getElementById('displayMax').textContent = `${data.max_dose} ${unit}`;
    document.getElementById('displayRec').textContent = `${data.recommended_dose} ${unit}`;

    document.getElementById('metaMedName').textContent = data.medication;
    const noteParts = [data.condition, data.notes].filter(Boolean).join(' · ');
    document.getElementById('metaNotes').textContent = noteParts;
    document.getElementById('medMeta').style.display = 'block';

    document.getElementById('cardDosage').classList.remove('locked');
    document.getElementById('prescribed').value = '';

    // Clear previous status & background
    document.getElementById('statusBanner').className = 'status-banner';
    document.body.className = '';

    document.getElementById('cardDosage').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  function checkDose() {
    if (!doseData) return;

    const prescribed = parseFloat(document.getElementById('prescribed').value);
    const banner     = document.getElementById('statusBanner');

    if (!prescribed || prescribed <= 0) {
      banner.className = 'status-banner';
      document.body.className = '';
      return;
    }

    const { min_dose, max_dose, recommended_dose, unit = 'mg', medication } = doseData;

    if (prescribed > max_dose) {
      const over = round(prescribed - max_dose);
      setStatus('high', '⚠️', 'DOSE TOO HIGH',
        `${prescribed} ${unit} exceeds the maximum safe dose of ${max_dose} ${unit} by ${over} ${unit}. Please review before administering.`);
      document.body.className = 'state-high';

    } else if (prescribed < min_dose) {
      const under = round(min_dose - prescribed);
      setStatus('low', '⚡', 'DOSE BELOW MINIMUM',
        `${prescribed} ${unit} is ${under} ${unit} below the minimum effective dose of ${min_dose} ${unit}. This may be ineffective.`);
      document.body.className = 'state-low';

    } else {
      setStatus('safe', '✓', 'DOSE WITHIN SAFE RANGE',
        `${prescribed} ${unit} of ${medication} is within the acceptable range of ${min_dose}–${max_dose} ${unit}. Recommended dose is ${recommended_dose} ${unit}.`);
      document.body.className = 'state-safe';
    }
  }

  function setStatus(type, icon, title, detail) {
    document.getElementById('statusIcon').textContent   = icon;
    document.getElementById('statusTitle').textContent  = title;
    document.getElementById('statusDetail').textContent = detail;
    document.getElementById('statusBanner').className   = `status-banner ${type} show`;
  }

  function showError(el, msg) {
    el.textContent = msg;
    el.classList.add('show');
  }

  function round(n) { return Math.round(n * 10) / 10; }

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && document.activeElement.id !== 'prescribed') fetchDosage();
  });
</script>
</body>
</html>